# Neil's Wercker Pipeline AWS demo App
box: fed007/nginx-flask

build:
  steps:
    - script:
        name: echo
        code: |
          echo "Neils Production Pipeline Here"
          sudo supervisord &          
          # commands below are now built into the docker for auto start , neil
          # sudo service nginx start &
          # sudo python /deploy/app/hello.py &


dev:
  steps:    
    - script:
        name: echo
        code: |
          echo "Neils Dev Pipeline Here"
          sudo supervisord &
          # commands below are now built into the docker for auto start , neil
          # sudo service nginx start &
          # sudo python /deploy/app/hello.py &
    
    - internal/shell


deploy:
  steps:
    - script:
        name: debug step 1
        code: | 
          ls $WERCKER_OUTPUT_DIR/pkg

    - tcnksm/zip:
      input: $WERCKER_OUTPUT_DIR/pkg
      output: $WERCKER_OUTPUT_DIR/dist

    - script:
        name: debug step 2
        code: | 
          ls $WERCKER_OUTPUT_DIR/dist

    - s3sync:
      key-id: $AWS_ACCESS_KEY
      key-secret: $AWS_SECRET_KEY
      bucket-url: $S3_BUCKET_NAME
 
