# Neil's Wercker Pipeline AWS demo App
box: fed007/nginx-flask

build:
  steps:
    - script:
        name: echo
        code: |
          echo "Neils Production Pipeline Here"
          sudo supervisord &          
          # commands below are now built into the docker for auto start , neil
          # sudo service nginx start &
          # sudo python /deploy/app/hello.py &


dev:
  steps:    
    - script:
        name: echo
        code: |
          echo "Neils Dev Pipeline Here"
          sudo supervisord &
          # commands below are now built into the docker for auto start , neil
          # sudo service nginx start &
          # sudo python /deploy/app/hello.py &
    
    - internal/shell


deploy:
  steps:

    - script:
        name:  Install Zip for transport and zip step.
        code: | 
           sudo apt-get -y install zip

    - script:
        name: debug step 1
        code: | 
           if [ -d $WERCKER_OUTPUT_DIR ]; then ls $WERCKER_OUTPUT_DIR; fi;

    - tcnksm/zip:
      input: $WERCKER_SOURCE_DIR
      output: $WERCKER_OUTPUT_DIR

    - script:
        name: debug step 2
        code: | 
          ls $WERCKER_OUTPUT_DIR

    - s3sync:
      key-id: $AWS_ACCESS_KEY
      key-secret: $AWS_SECRET_KEY
      bucket-url: $S3_BUCKET_NAME
      
 
